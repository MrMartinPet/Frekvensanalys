async function loadStructureFromExcel(){
  const res = await fetch("frekvensanalys_kategorier.xlsx");
  if(!res.ok){
    throw new Error("Kunde inte hämta frekvensanalys_kategorier.xlsx");
  }
  const buf = await res.arrayBuffer();

  const wb = XLSX.read(buf, { type: "array" });
  const sheetName = wb.SheetNames[0];
  const sheet = wb.Sheets[sheetName];
  const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

  const header = (rows[0] || []).map(h => (h || "").toString().trim());
  const idxCat = header.indexOf("Kategori");

  // stöd både "Underkategori" och "Aktivitet" som kolumn 2
  const idxSub = header.indexOf("Underkategori");
  const idxAct = header.indexOf("Aktivitet");

  if(idxCat === -1){
    throw new Error("Filen måste ha rubriken: Kategori");
  }

  const treeMap = new Map();

  // Helper: hämta/skap kategori
  function ensureCat(catName){
    if(!treeMap.has(catName)){
      treeMap.set(catName,{
        name: catName,
        color: categoryColors[catName] || "#ffffff",
        subs: [],
        isOther: catName === "Övrigt"
      });
    }
    return treeMap.get(catName);
  }

  // FALL 1: Klassisk 3-kolumnsfil
  if(idxSub !== -1 && idxAct !== -1){
    for(let i=1; i<rows.length; i++){
      const row = rows[i];
      if(!row) continue;

      const catName = (row[idxCat] || "").toString().trim();
      const subName = (row[idxSub] || "").toString().trim();
      const actName = (row[idxAct] || "").toString().trim();
      if(!catName || !subName || !actName) continue;

      const cat = ensureCat(catName);

      let sub = cat.subs.find(s => s.name === subName);
      if(!sub){
        sub = { name: subName, acts: [] };
        cat.subs.push(sub);
      }
      if(!sub.acts.includes(actName)){
        sub.acts.push(actName);
      }
    }

    model.tree = Array.from(treeMap.values());
    return;
  }

  // FALL 2: 2-kolumnsfil (Kategori + Underkategori/Aktivitet)
  // Vi lägger allt i en enda "sub" per kategori, men använder kolumn-2-texten som aktivitetsnamn.
  const idxSecond = (idxSub !== -1) ? idxSub : idxAct;
  if(idxSecond === -1){
    throw new Error("Filen måste ha rubrikerna: Kategori + (Underkategori eller Aktivitet)");
  }

  for(let i=1; i<rows.length; i++){
    const row = rows[i];
    if(!row) continue;

    const catName = (row[idxCat] || "").toString().trim();
    const actName = (row[idxSecond] || "").toString().trim(); // behandlas som aktivitet
    if(!catName || !actName) continue;

    const cat = ensureCat(catName);

    let sub = cat.subs.find(s => s.name === "Aktiviteter");
    if(!sub){
      sub = { name: "Aktiviteter", acts: [] };
      cat.subs.push(sub);
    }
    if(!sub.acts.includes(actName)){
      sub.acts.push(actName);
    }
  }

  model.tree = Array.from(treeMap.values());
}
